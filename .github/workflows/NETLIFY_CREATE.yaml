name: Update NETLIFY index

on:
  push:
    paths:
      - 'NETLIFY/**/*.html'   # triggers when any HTML file inside NETLIFY changes (add, modify, delete)
    branches:
      - main                  # change if your default branch is different

permissions:
  contents: write             # needed to commit back the updated index.html

jobs:
  generate-index:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Generate index.html
        run: |
          # Create the NETLIFY folder if it doesn't exist
          mkdir -p NETLIFY

          # Start building the HTML file
          cat > NETLIFY/index.html << 'EOF'
          <!DOCTYPE html>
          <html>
          <head>
            <title>NETLIFY HTML Index</title>
            <meta charset="UTF-8">
          </head>
          <body>
            <h1>HTML Files in NETLIFY</h1>
            <ul>
          EOF

          # Find all .html files inside NETLIFY (excluding index.html itself)
          # Sort them alphabetically and generate list items
          find NETLIFY -type f -name "*.html" ! -name "index.html" -printf '%P\0' | sort -z | while IFS= read -r -d '' file; do
            echo "              <li><a href=\"$file\">$file</a></li>" >> NETLIFY/index.html
          done

          # Close the HTML tags
          cat >> NETLIFY/index.html << 'EOF'
            </ul>
          </body>
          </html>
          EOF

      - name: Commit and push if changed
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add NETLIFY/index.html
          if git diff --staged --quiet; then
            echo "No changes to index.html"
          else
            git commit -m "Update NETLIFY/index.html [skip ci]"
            git push
          fi
