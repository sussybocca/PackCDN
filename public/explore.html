<!DOCTYPE html>
<html>
<head>
  <title>Explore Packs - PackCDN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, sans-serif; background: #f8f9fa; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    header { background: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .search-box { display: flex; gap: 10px; margin-top: 20px; }
    .search-box input { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 5px; font-size: 16px; }
    .search-box button { padding: 12px 30px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .filters { display: flex; gap: 10px; margin-top: 15px; }
    .filter-btn { padding: 8px 16px; background: white; border: 1px solid #ddd; border-radius: 20px; cursor: pointer; }
    .filter-btn.active { background: #667eea; color: white; border-color: #667eea; }
    .packs-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
    .pack-card { background: white; border-radius: 10px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); cursor: pointer; transition: transform 0.2s; }
    .pack-card:hover { transform: translateY(-5px); }
    .pack-header { display: flex; justify-content: space-between; align-items: start; }
    .pack-type { background: #e9ecef; color: #495057; padding: 4px 10px; border-radius: 15px; font-size: 12px; }
    .pack-name { font-size: 18px; font-weight: bold; margin: 10px 0; }
    .pack-meta { color: #6c757d; font-size: 14px; }
    .pack-stats { display: flex; gap: 15px; margin-top: 15px; font-size: 14px; }
    .pack-stat { display: flex; align-items: center; gap: 5px; }
    .empty-state { text-align: center; padding: 60px 20px; color: #6c757d; }
    .load-more { text-align: center; margin: 40px 0; }
    .load-btn { padding: 12px 40px; background: white; border: 2px solid #667eea; color: #667eea; border-radius: 5px; cursor: pointer; font-size: 16px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Explore Packs</h1>
      <p>Discover and use packages created by the community</p>
      
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search packages...">
        <button onclick="searchPacks()">Search</button>
      </div>
      
      <div class="filters">
        <div class="filter-btn active" data-type="all" onclick="setFilter('all')">All</div>
        <div class="filter-btn" data-type="npm" onclick="setFilter('npm')">NPM</div>
        <div class="filter-btn" data-type="python" onclick="setFilter('python')">Python</div>
        <div class="filter-btn" data-type="wasm" onclick="setFilter('wasm')">WASM</div>
      </div>
    </header>
    
    <div id="packsContainer" class="packs-grid">
      <!-- Packs will be loaded here -->
    </div>
    
    <div id="emptyState" class="empty-state" style="display: none;">
      <h3>No packs found</h3>
      <p>Try a different search or create your own pack!</p>
      <a href="editor.html" style="color: #667eea; text-decoration: none;">Create a Pack ‚Üí</a>
    </div>
    
    <div class="load-more">
      <button class="load-btn" onclick="loadMore()" id="loadMoreBtn" style="display: none;">Load More</button>
    </div>
  </div>

  <script>
    let currentPage = 1;
    let currentFilter = 'all';
    let currentSearch = '';
    let hasMore = false;
    
    // Load packs on page load
    window.onload = loadPacks;
    
    // Enter key to search
    document.getElementById('searchInput').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') searchPacks();
    });
    
    async function loadPacks(reset = false) {
      if (reset) {
        currentPage = 1;
        document.getElementById('packsContainer').innerHTML = '';
        document.getElementById('loadMoreBtn').style.display = 'none';
      }
      
      const params = new URLSearchParams({
        page: currentPage,
        limit: 12
      });
      
      if (currentFilter !== 'all') params.set('type', currentFilter);
      if (currentSearch) params.set('q', currentSearch);
      
      const response = await fetch(`/api/search?${params}`);
      const result = await response.json();
      
      if (result.success) {
        displayPacks(result.packs);
        hasMore = result.hasMore;
        
        if (hasMore) {
          document.getElementById('loadMoreBtn').style.display = 'block';
        }
        
        // Show/hide empty state
        if (result.packs.length === 0 && currentPage === 1) {
          document.getElementById('emptyState').style.display = 'block';
        } else {
          document.getElementById('emptyState').style.display = 'none';
        }
      }
    }
    
    function displayPacks(packs) {
      const container = document.getElementById('packsContainer');
      
      packs.forEach(pack => {
        const card = document.createElement('div');
        card.className = 'pack-card';
        card.onclick = () => window.open(`https://packcdn.firefly-worker.workers.dev/pack/${pack.id}`, '_blank');
        
        card.innerHTML = `
          <div class="pack-header">
            <span class="pack-type">${pack.package_type.toUpperCase()}</span>
            <span class="pack-meta">v${pack.version}</span>
          </div>
          <div class="pack-name">${pack.name}</div>
          <div class="pack-stats">
            <div class="pack-stat">üëÅÔ∏è ${pack.views || 0} views</div>
            <div class="pack-stat">üì• ${pack.downloads || 0} downloads</div>
          </div>
          <div style="margin-top: 15px; font-size: 12px; color: #999;">
            Created ${formatDate(pack.created_at)}
          </div>
        `;
        
        container.appendChild(card);
      });
    }
    
    function searchPacks() {
      currentSearch = document.getElementById('searchInput').value;
      loadPacks(true);
    }
    
    function setFilter(type) {
      currentFilter = type;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.toggle('active', btn.dataset.type === type);
      });
      loadPacks(true);
    }
    
    function loadMore() {
      currentPage++;
      loadPacks(false);
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diff = now - date;
      
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 60) return `${minutes}m ago`;
      if (hours < 24) return `${hours}h ago`;
      if (days < 7) return `${days}d ago`;
      
      return date.toLocaleDateString();
    }
  </script>
</body>
</html>
